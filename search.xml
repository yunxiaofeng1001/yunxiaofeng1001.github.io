<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Docker添加私有镜像库</title>
    <url>/2017/07/26/Docker%E6%B7%BB%E5%8A%A0%E7%A7%81%E6%9C%89%E9%95%9C%E5%83%8F%E5%BA%93/</url>
    <content><![CDATA[<pre><code>因为当初双系统给Linux分配硬盘小了~ 可悲的是镜像沾满了所有硬盘.索性全部全盘全格式化了从新安装了.(没有备份,各种文件找不到)但是发现一个问题.忘了私有镜像库的配制方法...好吧原谅我老了健忘...
</code></pre>
<span id="more"></span>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;je&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//修改这个文件.</span><br><span class="line">$ /etc/defaults/docker</span><br><span class="line">DOCKER_OPTS=<span class="string">&quot;<span class="variable">$DOCKER_OPTS</span> --registry-mirror=registry.domain.org&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">registry.domain.org/elk/elasticsearch:latest</span><br><span class="line">Error response from daemon: invalid registry endpoint https://registry.domain.org/v0/: unable to ping registry endpoint https://registry.domain.org/v0/</span><br><span class="line">v2 ping attempt failed with error: Get https://registry.domain.org/v2/: x509: certificate signed by unknown authority</span><br><span class="line">v1 ping attempt failed with error: Get https://registry.domain.org/v1/_ping: x509: certificate signed by unknown authority. If this private registry supports only HTTP or HTTPS with an unknown CA certificate, please add `--insecure-registry registry.domain.org` to the daemon<span class="string">&#x27;s arguments. In the case of HTTPS, if you have access to the registry&#x27;</span>s CA certificate, no need <span class="keyword">for</span> the flag; simply place the CA certificate at /etc/docker/certs.d/registry.domain.org/ca.crt</span><br></pre></td></tr></table></figure>


<p>上面写的很明白了~ https~ 但是我没有证书.翻箱倒柜.终于找到当初生成的证书…但是需要放在/etc/docker/certs.d/registry.domain.org/目录下的 ca.crt文件<br>这里貌似必须用 root 用户新建这个文件.然后拷贝你的证书内容进去,别问我为什么.我也不知道…</p>
<p>捂脸望天</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
        <tag>DevOps</tag>
      </tags>
  </entry>
  <entry>
    <title>MongoDB入门教程</title>
    <url>/2019/03/17/MongoDB%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<p>突发奇想,想要在家里的笔记本上安装个MongoDB,平时偶尔能用一下来进行测试,既然笔记本上有Docker环境,当然要利用起来了</p>
<span id="more"></span>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run --name mongodb -p 27017:27017 -e MONGO_INITDB_ROOT_USERNAME=admin -e MONGO_INITDB_ROOT_PASSWORD=admin  -d mongo --auth --authenticationDatabase heheda</span><br></pre></td></tr></table></figure>
<ul>
<li>使用认证方式登录MongoDB <strong>–auth</strong> .</li>
<li>管理员用户名 <strong>MONGO_INITDB_ROOT_USERNAME</strong> 设置</li>
<li>管理员用户名密码 <strong>MONGO_INITDB_ROOT_PASSWORD</strong> 设置</li>
</ul>
<p>现在你有了一个管理员账户,但是对于不同的数据库,要使用不同的用户,怎么控制呢? </p>
<p>Let’s get it ,我现在需要一个demo数据库,并且需要一个用户对demo数据库有完全管理权限.用户名和密码就都是demo吧</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; mongo 192.168.123.123:27017/admin -u admin -p admin</span><br><span class="line">&gt; use demo</span><br><span class="line">switched to db demo</span><br><span class="line">&gt; db.createUser(&#123;user:<span class="string">&quot;demo&quot;</span>,<span class="built_in">pwd</span>:<span class="string">&quot;demo&quot;</span>,roles:[&#123;<span class="string">&quot;role&quot;</span>:<span class="string">&quot;dbAdmin&quot;</span>,<span class="string">&quot;db&quot;</span>:<span class="string">&quot;demo&quot;</span>&#125;]&#125;)</span><br><span class="line">Successfully added user: &#123;</span><br><span class="line">	<span class="string">&quot;user&quot;</span> : <span class="string">&quot;demo&quot;</span>,</span><br><span class="line">	<span class="string">&quot;roles&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;role&quot;</span> : <span class="string">&quot;dbAdmin&quot;</span>,</span><br><span class="line">			<span class="string">&quot;db&quot;</span> : <span class="string">&quot;demo&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>登录到Docker上的mongo server ,我使用本地装好的mongo client ,<code>use demo</code>选择一个数据库,这样也就是创建了一个数据库,<code>createUser</code>在demo数据库下,创建了一个demo用户,用户名密码都是demo.<code>&#123;&quot;role&quot;:&quot;dbAdmin&quot;,&quot;db&quot;:&quot;demo&quot;&#125;</code> dbAdmin: 数据库管理员,具体有什么权限参照下面</p>
<ul>
<li>read:允许用户读取指定数据库 </li>
<li>readWrite:允许用户读写指定数据库 </li>
<li>dbAdmin：允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile </li>
<li>userAdmin：允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户 </li>
<li>clusterAdmin：只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。 </li>
<li>readAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读权限 </li>
<li>readWriteAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读写权限 </li>
<li>userAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的userAdmin权限 </li>
<li>dbAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。 </li>
<li>root：只在admin数据库中可用。超级账号，超级权限</li>
</ul>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>Docker</tag>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>Map学习</title>
    <url>/2018/03/26/Map%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="Map学习手记"><a href="#Map学习手记" class="headerlink" title="Map学习手记"></a>Map学习手记</h1><h2 id="Map结构特性"><a href="#Map结构特性" class="headerlink" title="Map结构特性."></a>Map结构特性.</h2><h2 id="实现类"><a href="#实现类" class="headerlink" title="实现类"></a>实现类</h2><h3 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h3><h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul>
<li>HashMap类是基于哈希表的map接口的实现,并且允许使用null键和null值</li>
<li>HashMap实现了Map并扩展了AbstractMap类,本身并没有增加新的方法</li>
<li>散列映射不保证元素的顺序,元素加入容器的顺序和读取的顺序可能并不相同,而且<strong>不保证</strong>顺序是<strong>恒久不变</strong>的<h4 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h4></li>
</ul>
<span id="more"></span>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">HapMap();</span><br><span class="line">HapMap(Map m);</span><br><span class="line">HapMap(<span class="keyword">int</span> capacity);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs an empty &lt;tt&gt;HashMap&lt;/tt&gt; with the specified initial</span></span><br><span class="line"><span class="comment"> * capacity and load factor.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  initialCapacity the initial capacity   初始化的容量</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  loadFactor      the load factor  扩展因子  TODO待理解</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalArgumentException if the initial capacity is negative</span></span><br><span class="line"><span class="comment"> *         or the load factor is nonpositive</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">HapMap(<span class="keyword">int</span> capacity,<span class="keyword">float</span> loadFactor);</span><br></pre></td></tr></table></figure>
<h4 id="关键函数"><a href="#关键函数" class="headerlink" title="关键函数"></a>关键函数</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(Object key)</span> </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;K&gt; <span class="title">keySet</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Set&lt;Entry&lt;K,V&gt;&gt; <span class="title">entrySet</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p><img src="http://img.yunxf.net/HashMap-put-method.png" alt="hashmap put method"></p>
]]></content>
      <categories>
        <category>JDK</category>
      </categories>
      <tags>
        <tag>JDK</tag>
        <tag>手记</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx小记</title>
    <url>/2017/07/26/Nginx%E5%B0%8F%E8%AE%B0/</url>
    <content><![CDATA[<p>闲来无聊看看 Nginx .</p>
<ul>
<li>操作系统: Ubuntu 14.04</li>
<li>安装方式: Build source</li>
<li>安装之前使用./configure 检查是否可以进行安装是否缺少模块</li>
</ul>
<span id="more"></span>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ./configure --prefix=/usr/<span class="built_in">local</span>/nginx --with-http_ssl_module --with-http_spdy_module --with-http_stub_status_module --with-pcre</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>发生错误:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ./configure: error: the HTTP rewrite module requires the PCRE library.</span><br></pre></td></tr></table></figure>
<p>解决办法:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get install libpcre3 libpcre3-dev</span><br></pre></td></tr></table></figure>

<p>然后继续执行./configure 的命令 发现又少东西了~  这次是 openssl</p>
<p>发生错误:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ./configure: error: SSL modules require the OpenSSL library.</span><br></pre></td></tr></table></figure>
<p>解决办法:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install openssl libssl-dev</span><br></pre></td></tr></table></figure>
<p>然后继续./configure </p>
<p>OK 搞定了~  安装吧~</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ make </span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>
<p>nginx.conf 配置<br>需求:是想让 nginx 反向代理到本机 node express 启动的一个web 程序上但是想让在解析的时候浏览器输入 localhost8081/express 解析解析到localhost:3000上.</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">        listen       8081;<span class="comment">//监听本机8081端口</span></span><br><span class="line">        server_name  yun.he.he;<span class="comment">//编辑本机 hosts 127.0.0.1解析到 yun.he.he 域名</span></span><br><span class="line">        #root /data/www/yun; <span class="comment">//反向代理后没用</span></span><br><span class="line">        location /express/ &#123; <span class="comment">//解析url 中的/express</span></span><br><span class="line">	    rewrite /express/(.*) /$1 break;  <span class="comment">//重写路径  $1代表前面 小括号内的内容 并且/ express 不进行转发</span></span><br><span class="line">            proxy_pass http:<span class="comment">//10.32.43.42:3000;//讲上面的地址转发到这个 url</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>服务器</category>
      </categories>
      <tags>
        <tag>手记</tag>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>从头装一次Macbook pro 2019</title>
    <url>/2020/02/23/build-new-macbook-pro/</url>
    <content><![CDATA[<h1 id="我的新电脑装了哪些软件"><a href="#我的新电脑装了哪些软件" class="headerlink" title="我的新电脑装了哪些软件"></a>我的新电脑装了哪些软件</h1><h3 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h3><ul>
<li>Chrome<ul>
<li>登录个人账户,同步插件和设置,密码等信息.</li>
</ul>
</li>
<li>Typro  最好用的markdown编辑器</li>
<li>搜狗输入发</li>
<li>V2rayX 你懂得</li>
<li>Iterm2<ul>
<li>oh-my-zsh 需要安装苹果自带的工具, 里面含有git</li>
</ul>
</li>
<li>Alfred4.0.4 (原谅我可耻的使用了破解版)<span id="more"></span></li>
<li>安装Mac 神器 Homebrew<ul>
<li>git</li>
<li>git-flow-avh</li>
<li>maven</li>
<li>node@12 暂缓</li>
<li>telnet / wget </li>
<li>htop</li>
</ul>
</li>
<li>JDK8</li>
<li>WPS 这个大家都懂, 在mac上的Office 实在是…太难用了</li>
<li>vs code( Visual Studio Code) <ul>
<li>Plugin  Chinese Language Pack </li>
<li>json Tools</li>
<li>XML tools</li>
<li>YAML </li>
</ul>
</li>
<li>Intellj </li>
<li>百度网盘</li>
<li>Transmit.app (FTP工具)</li>
<li>IINA 用起来还不错的播放器</li>
<li>Parallels Desktop for Mac  (没办法, 所在单位必须用windows)<ul>
<li>安装windows 10 专业版 x64</li>
</ul>
</li>
<li>安装窗口管理软件 SizeUp</li>
<li>截图软件  “截图” </li>
<li>印象笔记</li>
<li>微软TODO</li>
<li>Bartender for Mac (用于管理导航栏小图标)</li>
<li>docker <ul>
<li>修改docker for mac 的镜像下载地址</li>
</ul>
</li>
<li>安装博客软件hexo</li>
</ul>
<h3 id="系统设置"><a href="#系统设置" class="headerlink" title="系统设置"></a>系统设置</h3><ul>
<li><p>键盘:</p>
<ul>
<li>系统-&gt;键盘-&gt;重复前延迟 , 调整到合适的时间.</li>
</ul>
</li>
<li><p>关闭SIP</p>
<ul>
<li>重启电脑.</li>
<li>开机使用Comand+R进入</li>
<li>使用terminal 并且执行命令<code>csrutil status</code> 检查SIP状况</li>
<li><code>System Integrity Protection status: enabled.</code> 或者<code>System Integrity Protection status: disable</code></li>
<li>执行命令<code>csrutil disable</code> 关闭SIP</li>
</ul>
</li>
<li><p>允许任何来源软件</p>
<ul>
<li>执行命令<code>sudo spctl --master-disable</code></li>
</ul>
</li>
<li><p>安装git repository 管理插件. </p>
<ul>
<li><code>npm install projj -g</code></li>
</ul>
</li>
<li><p>修改iterm2中的vim 配色方案</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">创建 ~/.vimrc</span></span><br><span class="line"><span class="meta">#</span><span class="bash">编辑一下内容</span></span><br><span class="line">syntax enable</span><br><span class="line">set background=dark</span><br><span class="line">colorscheme Tomorrow-Night</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">创建 ~/.vim/coclors</span></span><br><span class="line"><span class="meta">#</span><span class="bash">拷贝原有配色方案 Tomorrow-Night.vim 到目录下</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置hexo的相关地址</p>
</li>
<li><p>设置Mac Dock 隐藏/显示的时间延迟,默认将鼠标移动到Dock位置会有一定时间的延迟.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">defaults write com.apple.Dock autohide-delay -float 0 &amp;&amp; killall Dock</span><br><span class="line"><span class="meta">#</span><span class="bash">如果想要恢复</span></span><br><span class="line">defaults delete com.apple.Dock autohide-delay &amp;&amp; killall Dock</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="数据迁移"><a href="#数据迁移" class="headerlink" title="数据迁移"></a>数据迁移</h3><ul>
<li>maven本地包迁移</li>
<li>迁移原有代码仓库</li>
<li>迁移工作用文档</li>
<li>迁移原有ssh 私钥公钥</li>
</ul>
]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>diary</tag>
      </tags>
  </entry>
  <entry>
    <title>java集合容器</title>
    <url>/2018/03/16/java%E9%9B%86%E5%90%88%E5%AE%B9%E5%99%A8/</url>
    <content><![CDATA[<p>突然发现,每天深陷业务的纠缠中无法自拔,对于Java的基础部分知之甚少.所以开始看看一些java core基础的部分<br>今天来了解一下集合容器</p>
<span id="more"></span>
<h1 id="Java集合框架"><a href="#Java集合框架" class="headerlink" title="Java集合框架"></a>Java集合框架</h1><ul>
<li>用来表示和操作集合的统一的架构,它包含了实现集合的接口与类</li>
<li>不同的集合类有不同的数据结构,在使用中要根据不同的性能要求,使用不同的集合类</li>
<li>有哪些接口<ul>
<li>Iterable 迭代器接口</li>
<li>Collection 类集合接口</li>
<li>List 列表接口</li>
<li>Set 数据集接口</li>
<li>Queue 对接裂口</li>
<li>Map 键值对映射表</li>
</ul>
</li>
</ul>
<h2 id="Iterable-接口"><a href="#Iterable-接口" class="headerlink" title="Iterable 接口"></a>Iterable 接口</h2><ul>
<li>实现该接口允许对象成为”foreach”语句的目标,也就是该集合允许迭代 </li>
<li>迭代器是实现了Iterator/ListIterator 接口的类的对象,可以通过遍历类集,访问操作其中的每个元素</li>
<li>ListIterator 扩展了 Iterator, 允许<strong>双向遍历</strong>集合,并且可以删除和修改元素 </li>
<li>ListIterator 根据方法发现可以去到上一个元素<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 是否有上一个元素</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">hasPrevious</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 取上一个元素</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">E <span class="title">previous</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(String it:array) <span class="comment">//循环方式</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="Collection-类集接口"><a href="#Collection-类集接口" class="headerlink" title="Collection 类集接口"></a>Collection 类集接口</h2><ul>
<li>是Iterable接口的<strong>子接口</strong>,所有类集对象可以访问,但是Map不行.</li>
<li>存放各种元素.有些是<strong>有序</strong>有些是<strong>无序</strong>的<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回一个在一组T类型的元素上进行迭代的迭代器.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Iteator&lt;T&gt; <span class="title">iterator</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="List-Set-Map"><a href="#List-Set-Map" class="headerlink" title="List/ Set /Map"></a>List/ Set /Map</h2></li>
<li>List<ul>
<li>扩展了Collection</li>
<li>是一个<strong>有序</strong>的容器</li>
<li>存放的元素是<strong>可重复</strong>的<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">ListIterator&lt;E&gt; <span class="title">listIterator</span><span class="params">()</span></span>;<span class="comment">//成为一个可以双向遍历的迭代器对象</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>Set<ul>
<li>扩展了Collection</li>
<li>是一个<strong>无序</strong>的容器</li>
<li>存放的元素是<strong>不可重复</strong>的</li>
</ul>
</li>
<li>Map<ul>
<li>是一个存储关键字键/值对的对象,可以通过键查询到所对应的值,键和值都可以是对象</li>
<li>并不是Collection的子接口,所以Map本身不能使用迭代器来进行遍历</li>
</ul>
</li>
</ul>
<h2 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h2><ul>
<li>调用一个无参的构造方法的时候,会在内部调用一个初始大小为<strong>10</strong>的ArrayList对象</li>
<li>可以添加<strong>null</strong>为容器中的一个元素</li>
<li>当添加一个元素的时候<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">* 产生一个新的数组,并且容量是原有数组大小的1.5倍</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// overflow-conscious code</span></span><br><span class="line">        <span class="keyword">int</span> oldCapacity = elementData.length;<span class="comment">//当前容器内数组的大小</span></span><br><span class="line">        <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);<span class="comment">//原有容器内数组大小+容器大小右移一位(右移一位可以视为计算除以2)</span></span><br><span class="line">        <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">            newCapacity = minCapacity;</span><br><span class="line">        <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">            newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">        <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">        elementData = Arrays.copyOf(elementData, newCapacity);<span class="comment">//产生一个新的ArrayList对象,并将原来的元素拷贝到新的集合对象内,新的集合对象容量为原来的1.5倍</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h2><ul>
<li>是一个<strong>双向</strong>链表结构 Node节点有一个对于前一个节点的引用,后一个节点的引用<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    E item;</span><br><span class="line">    Node&lt;E&gt; next;</span><br><span class="line">    Node&lt;E&gt; prev;</span><br><span class="line"></span><br><span class="line">    Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123;</span><br><span class="line">        <span class="keyword">this</span>.item = element;</span><br><span class="line">        <span class="keyword">this</span>.next = next;</span><br><span class="line">        <span class="keyword">this</span>.prev = prev;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>实现了<strong>Deque</strong>(Double ended Queue 双端队列),继承自<strong>Queue</strong>队列,先进先出.</li>
</ul>
]]></content>
      <categories>
        <category>JDK</category>
      </categories>
      <tags>
        <tag>JDK</tag>
        <tag>手记</tag>
      </tags>
  </entry>
  <entry>
    <title>GraphQL的探索上手</title>
    <url>/2020/03/29/graphQL-initialize/</url>
    <content><![CDATA[<h3 id="一-GraphQL简介"><a href="#一-GraphQL简介" class="headerlink" title="一 GraphQL简介"></a>一 GraphQL简介</h3><ol>
<li><h4 id="GraphQL是什么"><a href="#GraphQL是什么" class="headerlink" title="GraphQL是什么"></a>GraphQL是什么</h4></li>
</ol>
<p><strong>为API而生的专用查询语言</strong></p>
<blockquote>
<p>GraphQL是一门为API和运行时而生的查询语言。它可以使用您已有的数据对这些查询进行填充。 GraphQL在您的API中，提供了一个完整的，易于理解的数据描述， 可以给予您的客户端一个权利，可以精确地描述他们所需要的数据，并不拖泥带水。 随着时间的推移，使得API的进化更加容易，并且开启强大的开发者工具</p>
</blockquote>
<ol start="2">
<li><h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4></li>
</ol>
<p>当提起API设计的时候，大家通常会想到SOAP，RESTful等设计方式，从2000年RESTful的理论被提出的时候，在业界引起了很大反响，因为这种设计理念更易于用户的使用，所以便很快的被大家所接受。我们知道REST是一种从服务器公开数据的流行方式。当REST的概念被提及出来时，客户端应用程序对数据的需求相对简单，而开发的速度并没有达到今天的水平。因此REST对于许多应用程序来说是非常适合的。然而在业务越发复杂，客户对系统的扩展性有了更高的要求时，API环境发生了巨大的变化。特别是从下面三个方面在挑战api设计的方式:</p>
<ul>
<li>移动端用户的爆发式增长需要更高效的数据加载**</li>
</ul>
<blockquote>
<p>Facebook开发GraphQL的最初原因是移动用户的增加、低功耗设备和松散的网络。GraphQL最小化了需要网络传输的数据量，从而极大地改善了在这些条件下运行的应用程序。</p>
</blockquote>
<ul>
<li><strong>各种不同的前端框架和平台</strong></li>
</ul>
<blockquote>
<p>前端框架和平台运行客户端应用程序的异构环境使得我们在构建和维护一个符合所有需求的API变得困难，使用GraphQL每个客户机都可以精确地访问它需要的数据。</p>
</blockquote>
<ul>
<li><strong>在不同前端框架，不同平台下想要加快产品快速开发变的越来越难</strong></li>
</ul>
<blockquote>
<p>持续部署已经成为许多公司的标准，快速的迭代和频繁的产品更新是必不可少的。对于REST api，服务器公开数据的方式常常需要修改，以满足客户端的特定需求和设计更改。这阻碍了快速开发实践和产品迭代。</p>
</blockquote>
<span id="more"></span>

<ol start="3">
<li><h4 id="接口架构设计"><a href="#接口架构设计" class="headerlink" title="接口架构设计"></a>接口架构设计</h4></li>
</ol>
<p>我们以<strong>用户</strong>和<strong>账户</strong>两个服务作为举例,进行,通过不同的接口设计实现功能.</p>
<ul>
<li><p>使用<strong>Restful</strong>的形式进行获取信息.</p>
<ol>
<li>通过/user/{id}获取用户信息</li>
<li>通过/user/{id}/accounts获取当前用户下所有账户</li>
<li>通过/account/{id}获取账户余额信息信息</li>
</ol>
<p>这期间我们为了获取用户的账户余额需要调用<strong>三次</strong>接口来完成我们需要的数据.</p>
</li>
<li><p>使用<strong>GraphQL</strong>的形式进行接口请求</p>
<p><strong>需求</strong>:请求张三这个用户下面的所有账户的余额</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">//我们的请求的入参</span></span><br><span class="line">query&#123;</span><br><span class="line">  User(id:<span class="string">&quot;d8f5377e-3dea-4830-8e45-bb62f9ca8e8e&quot;</span>)&#123;</span><br><span class="line">    name</span><br><span class="line">    age</span><br><span class="line">    identification</span><br><span class="line">    Account(ALL)&#123;</span><br><span class="line">      balance</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Post的请求返回结果是</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>:&#123;</span><br><span class="line">    <span class="attr">&quot;User&quot;</span>:&#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;张三&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;age&quot;</span>:<span class="number">12</span>,</span><br><span class="line">      <span class="attr">&quot;identification&quot;</span>:<span class="string">&quot;12332112321321321&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;Account&quot;</span>:[</span><br><span class="line">       	&#123;<span class="attr">&quot;id&quot;</span>:<span class="string">&quot;fc9a45ce-dd91-4ed2-8e43-a26412a03edd&quot;</span>,<span class="attr">&quot;balance&quot;</span>:<span class="number">12.32</span>&#125;,</span><br><span class="line">    		&#123;<span class="attr">&quot;id&quot;</span>:<span class="string">&quot;8d4832be-22f5-40c8-ab37-fc488843d4f1&quot;</span>,<span class="attr">&quot;balance&quot;</span>:<span class="number">19999.1</span>&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4></li>
</ol>
<ul>
<li><p>强类型约束</p>
<p>清晰的定义了每个API支持的操作，包括输入的参数和返回的内容</p>
</li>
<li><p><strong>根据前端需求来获取后端数据</strong></p>
<p>从<strong>后端提供什么前端展示什么</strong> —&gt; <strong>前端需要什么,后端提供什么</strong> 从思想上的转变,将数据的主动权转移到前端手中.</p>
</li>
<li><p><strong>talk is cheap ,show me code.</strong></p>
<ul>
<li>前端根据页面需求进行定义schema文件,根据schema进行独立开发,有开源的GraphQL模拟后端终端</li>
<li>后端根据schema文件进行解析器编写,这样互相之间分离,有明确的规则文件进行定义接口,排除语言或者文档传达不清的情况, 可以根据定义的规则代码进行简单的静态预发检查,避免不必要的低级错误</li>
</ul>
</li>
<li><p>版本迭代</p>
<ul>
<li>可以显示的表明接口过期.</li>
</ul>
</li>
</ul>
<ol start="5">
<li><h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li><p>会暴露数据库结构（字段名）,数据库字段名</p>
</li>
<li><p>嵌套查询，比较费性能</p>
</li>
<li><p>只能用于Post请求,CDN缓存如何做.</p>
</li>
<li><p>只是作为一个树状结构的查询语言,对于command写操作支持不好.</p>
</li>
<li><p>做权限验证比较困难,根据用户的角色来做不同的权限验证,逻辑更复杂.</p>
</li>
<li><p>对于前端减少了沟通,和网络请求次数, 对于后端而言,业务逻辑和数据的处理一点都不少,可能还需要些更多的代码.</p>
</li>
<li><p>Facebook仅开源了前端的代码,对于后端的解析和处理逻辑并未进行开源,现在大家使用的都是社区进行的开源,并未接触到有互联网大厂在生产大规模使用此项技术</p>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="二-原理分析"><a href="#二-原理分析" class="headerlink" title="二. 原理分析"></a>二. 原理分析</h3><p><img src="http://img.yunxf.net/graphql-img-2.png" alt="grapql-img-2"></p>
<p>​        <strong>客户端</strong> : 不管是手机端还是PC端,请求发送到服务端钱经过 GraphQL Client 转换成客户端Schema, 这里面描述了客户端的对数据的诉求,调用哪个方法, 传递什么样的参数,期望返回值有哪些字段.</p>
<p>​        <strong>服务端</strong> : 服务端拿到这段 Schema 之后，通过事先定义好的服务端 Schema 接收请求参数并执行对应的 <code>resolve</code> 函数提供数据服务。</p>
<p>​        识别和相应客户端的过程可以看做以下三个过程:  <strong>解析</strong>  <strong>校验</strong>  <strong>执行</strong></p>
<p><img src="http://img.yunxf.net/graphql-img-3.png" alt="graphql-img-3"></p>
<ul>
<li>解析阶段:为了识别客户端 Schema， <code>graphql-js</code> 定义了一系列的特征标识符：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">为了识别客户端 Schema， `graphql-js` 定义了一系列的特征标识符：</span></span><br><span class="line">export const TokenKind = Object.freeze(&#123;</span><br><span class="line">    BANG: &#x27;!&#x27;,</span><br><span class="line">    DOLLAR: &#x27;$&#x27;,</span><br><span class="line">    PAREN_L: &#x27;(&#x27;,</span><br><span class="line">    PAREN_R: &#x27;)&#x27;,</span><br><span class="line">    SPREAD: &#x27;...&#x27;,</span><br><span class="line">    COLON: &#x27;:&#x27;,</span><br><span class="line">    EQUALS: &#x27;=&#x27;,</span><br><span class="line">    BRACKET_L: &#x27;[&#x27;,</span><br><span class="line">    BRACKET_R: &#x27;]&#x27;,</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">定义了 AST 语法树规范</span></span><br><span class="line">/**</span><br><span class="line"> * The set of allowed kind values for AST nodes.</span><br><span class="line"> */</span><br><span class="line">export const Kind = Object.freeze(&#123;</span><br><span class="line">  // Name</span><br><span class="line">  NAME: &#x27;Name&#x27;,</span><br><span class="line"> </span><br><span class="line">  // Document</span><br><span class="line">  DOCUMENT: &#x27;Document&#x27;,</span><br><span class="line">  OPERATION_DEFINITION: &#x27;OperationDefinition&#x27;,</span><br><span class="line">  VARIABLE_DEFINITION: &#x27;VariableDefinition&#x27;,</span><br><span class="line">  VARIABLE: &#x27;Variable&#x27;,</span><br><span class="line"> </span><br><span class="line">  // Values</span><br><span class="line">  INT: &#x27;IntValue&#x27;,</span><br><span class="line">  FLOAT: &#x27;FloatValue&#x27;,</span><br><span class="line">  STRING: &#x27;StringValue&#x27;,</span><br><span class="line">  BOOLEAN: &#x27;BooleanValue&#x27;,</span><br><span class="line">  ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>校验阶段</strong></li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">//校验阶段用于验证客户端 Schema 是否按照服务端 Schema 定义好的方式获取数据，比如：获取数据的方法名是否有误，必填项是否有值等等</span></span><br><span class="line"><span class="comment">//如果出现错误,返回结构化的报错信息，还非常人性化的告诉你正确的调用方式是什么</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;errors&quot;</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;message&quot;</span>:<span class="string">&quot;Cannot query field &quot;</span>fetchByGen<span class="string">&quot; on type &quot;</span>Query<span class="string">&quot;. Did you mean &quot;</span>fetchByGender<span class="string">&quot;?&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;locations&quot;</span>:[</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;line&quot;</span>:<span class="number">3</span>,</span><br><span class="line">                    <span class="attr">&quot;column&quot;</span>:<span class="number">9</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>执行阶段</strong></p>
<p>执行阶段依赖的输入为：解析阶段的产出物 <code>document</code> ，服务端 Schema；其中 <code>document</code> 准确描述了客户端对数据的述求：请求哪个方法，参数是什么，需要哪些字段；服务端 Schema 描述了提供数据的方式</p>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>:&#123;</span><br><span class="line">    <span class="attr">&quot;User&quot;</span>:&#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;张三&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;age&quot;</span>:<span class="number">12</span>,</span><br><span class="line">      <span class="attr">&quot;identification&quot;</span>:<span class="string">&quot;12332112321321321&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;Account&quot;</span>:[</span><br><span class="line">       	&#123;<span class="attr">&quot;id&quot;</span>:<span class="string">&quot;fc9a45ce-dd91-4ed2-8e43-a26412a03edd&quot;</span>,<span class="attr">&quot;balance&quot;</span>:<span class="number">12.32</span>&#125;,</span><br><span class="line">    		&#123;<span class="attr">&quot;id&quot;</span>:<span class="string">&quot;8d4832be-22f5-40c8-ab37-fc488843d4f1&quot;</span>,<span class="attr">&quot;balance&quot;</span>:<span class="number">19999.1</span>&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="三-使用Springboot来搭建GraphQL后端程序"><a href="#三-使用Springboot来搭建GraphQL后端程序" class="headerlink" title="三.  使用Springboot来搭建GraphQL后端程序"></a>三.  使用Springboot来搭建GraphQL后端程序</h3><h4 id="1-引入开源的GraphQL的相关jar包"><a href="#1-引入开源的GraphQL的相关jar包" class="headerlink" title="1. 引入开源的GraphQL的相关jar包"></a>1. 引入开源的GraphQL的相关jar包</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.graphql-java<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>graphql-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.graphql-java<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>graphql-java-tools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong> : 根据SpringBoot的版本不同引入的GraphQL的版本也会不相同</p>
<h4 id="2-建数据库表"><a href="#2-建数据库表" class="headerlink" title="2. 建数据库表"></a>2. 建数据库表</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">User</span>` (</span><br><span class="line">  `id` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">  `created_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `updated_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">  `identification` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;identification&#x27;</span>,</span><br><span class="line">  `age` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;age&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `Account` (</span><br><span class="line">  `id` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">  `created_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `updated_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  `balance` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;余额&#x27;</span>,</span><br><span class="line">  `status` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">  `user_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-重点-建立解析器Resolver"><a href="#3-重点-建立解析器Resolver" class="headerlink" title="3. 重点:建立解析器Resolver"></a>3. 重点:建立解析器<strong>Resolver</strong></h3><p>UserResolver.java 用户解析字段</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserResolver</span> <span class="keyword">implements</span> <span class="title">GraphQLResolver</span>&lt;<span class="title">Author</span>&gt; </span>&#123;</span><br><span class="line"> 		<span class="comment">//数据一种仓库模式,可以使用Spring data jpa来实现 </span></span><br><span class="line">    <span class="keyword">private</span> AccountRepository accountRepository;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Account&gt; <span class="title">getBooks</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accountRepository.findByUserId(user.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>AccountResolver.java 账户信息解析字段</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountResolver</span> <span class="keyword">implements</span> <span class="title">GraphQLResolver</span>&lt;<span class="title">Book</span>&gt; </span>&#123;</span><br><span class="line"> 		<span class="comment">//数据一种仓库模式,可以使用Spring data jpa来实现 </span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(Account account)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> authorRepo.findUserById(account.getUserId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Mutation.java 用户数据的新增和更新的基本操作</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mutation</span> <span class="keyword">implements</span> <span class="title">GraphQLMutationResolver</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">    <span class="keyword">private</span> AccountRepository accountRepository;</span><br><span class="line"> </span><br><span class="line">  </span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment"> 		 * 新增用户</span></span><br><span class="line"><span class="comment">		 * </span></span><br><span class="line"><span class="comment">	   */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">newUser</span><span class="params">(String name, <span class="keyword">int</span> age, String identification)</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        author.setName(name);</span><br><span class="line">        author.setAge(age);</span><br><span class="line">      	author.setIdentification(identification);</span><br><span class="line">        <span class="keyword">return</span> userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line"> 		<span class="comment">/**</span></span><br><span class="line"><span class="comment"> 		 * 新增账户</span></span><br><span class="line"><span class="comment">	   */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">newAccount</span><span class="params">(String balance, String status, String userId)</span> </span>&#123;</span><br><span class="line">        Account account = <span class="keyword">new</span> Account();</span><br><span class="line">        book.setBalance(balance);</span><br><span class="line">        book.setStatus(status);</span><br><span class="line">        book.setUserId(userId);</span><br><span class="line">        <span class="keyword">return</span> accountRepository.save(account);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">  	<span class="comment">/**</span></span><br><span class="line"><span class="comment"> 		 * 保存/更新账户信息</span></span><br><span class="line"><span class="comment">	   */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">saveAccount</span><span class="params">(AccountInput input)</span> </span>&#123;</span><br><span class="line">        Account account = <span class="keyword">new</span> Account();</span><br><span class="line">        book.setBalance(balance);</span><br><span class="line">        book.setStatus(status);</span><br><span class="line">        book.setUserId(userId);</span><br><span class="line">        <span class="keyword">return</span> accountRepository.save(account);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">  	<span class="comment">/**</span></span><br><span class="line"><span class="comment"> 		 * 删除用户下账户信息</span></span><br><span class="line"><span class="comment">	   */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">deleteAccount</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accountRepository.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">  	<span class="comment">/**</span></span><br><span class="line"><span class="comment"> 		 * 更新账户状态</span></span><br><span class="line"><span class="comment">	   */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">updateAccountStatus</span><span class="params">(String Status,String id)</span> </span>&#123;</span><br><span class="line">        Account account = accountRepository.findAccountById(id);</span><br><span class="line">        book.setStatus(Status);</span><br><span class="line">        <span class="keyword">return</span> accountRepository.save(account);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Query.java查询解析相关代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Query</span> <span class="keyword">implements</span> <span class="title">GraphQLQueryResolver</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepo;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> AccountRepo accountRepo;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userRepo.findUserById(id);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAllUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userRepo.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">countUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userRepo.count();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Account&gt; <span class="title">findAllAccounts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accountRepo.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">countAccounts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accountRepo.count();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-建立GraphQL文件"><a href="#4-建立GraphQL文件" class="headerlink" title="4. 建立GraphQL文件"></a>4. 建立GraphQL文件</h3><p>在resource下面建立graphq文件夹,在里面包含两个文件<code>root.graphqls</code>和<code>schema.graphqls</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">//root.graphqls查询入口</span></span><br><span class="line">type Query &#123;</span><br><span class="line">    <span class="comment">// User相关 </span></span><br><span class="line">    findUserById(id:String!): User</span><br><span class="line"> </span><br><span class="line">    findAllUsers: [User]!</span><br><span class="line"> </span><br><span class="line">    countAuthors: Long!</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Account相关 </span></span><br><span class="line">    findAllAccount: [Account]!</span><br><span class="line">    countAccounts: Long!</span><br><span class="line">&#125;</span><br><span class="line">String balance, String status, String userId</span><br><span class="line"><span class="comment">// 更新/新增</span></span><br><span class="line">type Mutation &#123;</span><br><span class="line">    newUser(name: String!,age: int!,identification: String!) : Author!</span><br><span class="line">    newAccount(balance: String!,status: String!, userId: Long!) : Account!</span><br><span class="line">    saveAccount(input: AccountInput!) : Account!</span><br><span class="line">    deleteAccount(id: String!) : Boolean</span><br><span class="line">    updateAccountStatus(status: String!, id:String!) : Account!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义规则前后端都强类型一致的文件,并且要<strong>明确注释信息</strong>,前后端不用产生歧义</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 这是一个组织好的树状结构</span></span><br><span class="line">type User &#123;</span><br><span class="line">    <span class="comment">// 用户ID</span></span><br><span class="line">    id: String!</span><br><span class="line">    <span class="comment">// 创建时间</span></span><br><span class="line">    createdTime: String</span><br><span class="line">    <span class="comment">// 姓名</span></span><br><span class="line">    name: String</span><br><span class="line">    <span class="comment">// 年龄</span></span><br><span class="line">    age: int</span><br><span class="line">  	<span class="comment">// 身份证号</span></span><br><span class="line">  	identification: String</span><br><span class="line">    <span class="comment">// 该用户所关联的账户</span></span><br><span class="line">    accounts: [Account]</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">input AccountInput &#123;</span><br><span class="line">    balance: String!</span><br><span class="line">    status: String!</span><br><span class="line">    userId: String!</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">type Account &#123;</span><br><span class="line">    id: String!</span><br><span class="line">    balance: String!</span><br><span class="line">    status: String!</span><br><span class="line">    userId: User</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-测试"><a href="#5-测试" class="headerlink" title="5 测试"></a>5 测试</h4><p>我们将程序跑起来,进行一个简单的测试.GraphQL自带了一个界面化的测试工具并且还有代码提醒功能,这全都归结于我们前期对于<code>root.graphqls</code>和<code>schema.graphqls</code>的定义</p>
<p>在<a href="http://localhost:8080/graphiql">http://localhost:8080/graphiql</a> 界面进行测试界面如下</p>
<p><img src="http://img.yunxf.net/graphql-img-1.jpg" alt="graphql-img-1"></p>
]]></content>
      <categories>
        <category>server</category>
      </categories>
      <tags>
        <tag>Spring boot</tag>
        <tag>GraphQL</tag>
      </tags>
  </entry>
  <entry>
    <title>设计模式学习一</title>
    <url>/2018/03/19/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0%E4%B8%80/</url>
    <content><![CDATA[<h1 id="设计模式模式学习"><a href="#设计模式模式学习" class="headerlink" title="设计模式模式学习"></a>设计模式模式学习</h1><p>//TODO</p>
<h2 id="设计模式–迭代器模式"><a href="#设计模式–迭代器模式" class="headerlink" title="设计模式–迭代器模式"></a>设计模式–迭代器模式</h2><p>迭代器模式（Iterator），提供一种方法顺序访问一个聚合对象中的各种元素，而又不暴露该对象的内部表示。</p>
<p>最近在看List/ArrayList/LinkedList,明白了底层的实现方式,就在想,是不是自己可以也模仿写一个简单的ArrayList</p>
<span id="more"></span>
<p><img src="http://img.yunxf.net/iterator-img-class.png" alt="类图"></p>
<h2 id="设计模式–策略模式"><a href="#设计模式–策略模式" class="headerlink" title="设计模式–策略模式"></a>设计模式–策略模式</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><blockquote>
<p><strong>策略模式</strong>定义了算法族,分别封装起来.让他们之间可以互相替换,这个模式让算法的变化可以独立于使用算法的客户</p>
</blockquote>
<p>如果有个简单的需求,有一个鸭子,所有鸭子都是会游泳的,可以叫.可以飞,可以展示自己羽毛的颜色.<br>大家都知道,有一个Duck的抽象类.继承自抽象类的鸭子又可以自定义自己的display()方法来展示自己羽毛的颜色.<br>下面是一个简单的鸭子(Duck)的抽象类.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Duck</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 飞行行为的接口</span></span><br><span class="line"><span class="comment">    * 当符合飞行行为的接口的时候都可以使用不管是坐着火箭飞行,还是扇着翅膀飞行</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="keyword">private</span> FlyBehavior flyBehavior;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 喊叫行为的接口</span></span><br><span class="line"><span class="comment">    * 当符合喊叫行为接口的都可以放进来,不管是gaga 还是吱吱叫</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="keyword">private</span> CallBehavior callBehavior;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Duck</span><span class="params">(FlyBehavior flyBehavior, CallBehavior callBehavior)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.flyBehavior = flyBehavior;</span><br><span class="line">        <span class="keyword">this</span>.callBehavior = callBehavior;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Duck() &#123;</span><br><span class="line">        <span class="keyword">this</span>.flyBehavior = <span class="keyword">new</span> DefaultFlyBehavior();</span><br><span class="line">        <span class="keyword">this</span>.callBehavior = <span class="keyword">new</span> DefaultCallBehavior();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 展示自己</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 可以游泳</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">swim</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Duck can swim&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 飞行的方法,但是具体的实现不知道是谁</span></span><br><span class="line"><span class="comment">     * 在构造方法的时候确定&quot;飞行这个行为是怎么做的;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">fly</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">this</span>.flyBehavior.fly();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 鸭子叫的行为,但是这个行为不知道具体是怎么喊叫的.</span></span><br><span class="line"><span class="comment">     * 只有在真正的行为实现上才知道</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.callBehavior.call();</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在使用中动态的改变飞行的具体实现</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> flyBehavior</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFlyBehavior</span><span class="params">(DefaultFlyBehavior flyBehavior)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.flyBehavior = flyBehavior;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在鸭子使用中动态的定义鸭子叫声 可能是吱吱 或者嘎嘎</span></span><br><span class="line"><span class="comment">     * 只要是实现了CallBehavior接口的都可以</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> callBehavior</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCallBehavior</span><span class="params">(CallBehavior callBehavior)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.callBehavior = callBehavior;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 黄色的鸭子,这个黄色的鸭子使用默认的飞行(fly)和叫(call)的行为</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YellowDuck</span> <span class="keyword">extends</span> <span class="title">Duck</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">YellowDuck</span><span class="params">(FlyBehavior flyBehavior, CallBehavior callBehavior)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(flyBehavior, callBehavior);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">YellowDuck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot; I&#x27;m a Yellow Duck&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="设计模式–观察者模式"><a href="#设计模式–观察者模式" class="headerlink" title="设计模式–观察者模式"></a>设计模式–观察者模式</h2><h3 id="基本理念"><a href="#基本理念" class="headerlink" title="基本理念"></a>基本理念</h3><ul>
<li>超出程序中变化的部分,然后将这些和固定不变的部分分离开</li>
<li>针对接口编程,不针对实现编程</li>
<li>多用组合少用继承.</li>
</ul>
]]></content>
      <categories>
        <category>设计模式</category>
      </categories>
      <tags>
        <tag>JDK</tag>
        <tag>手记</tag>
        <tag>设计模式</tag>
      </tags>
  </entry>
</search>
